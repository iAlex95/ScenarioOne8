#!/bin/bash

#https://www.digitalocean.com/community/tutorials/how-to-serve-django-applications-with-apache-and-mod_wsgi-on-centos-7
#Install mod_wsgi
sudo yum install python-setuptools http mod_wsgi

#Install virtualenv
sudo pip install virtualenv

#Clone from github repository
cd
cd Desktop
git clone https://github.com/stupidjc/ScenarioOne8

#Configure the virtual environment
cd
cd Desktop/ScenarioOne8/toDoList

#Create virtual environment:
virtualenv myprojectenv
#Activate virtual environment
source myprojectenv/bin/activate
#Install Django in virtual environment
pip install django


echo 'STATIC_ROOT = os.path.join(BASE_DIR, "static/")' >> ~/Desktop/ScenarioOne8/toDoList/toDoList/settings.py
cd
cd ~/Desktop/ScenarioOne8/toDoList/manage.py
./manage.py collectstatic

#Leave virtual environment
deactivate

#Configure Apache
cd /etc/httpd/conf.d
touch django.conf

#Adding to django.conf

sudo echo 'Alias /static /home/user/myproject/static
<Directory /home/user/myproject/static>
    Require all granted
</Directory>

<Directory /home/user/myproject/myproject>
    <Files wsgi.py>
        Require all granted
    </Files>
</Directory>

WSGIDaemonProcess myproject python-path=/home/user/myproject:/home/user/myproject/myprojectenv/lib/python2.7/site-packages
WSGIProcessGroup myproject
WSGIScriptAlias / /home/user/myproject/myproject/wsgi.py' >> /etc/httpd/conf.d/django.conf
sudo echo 'LoadModule wsgi_module modules/mod_wsgi.so' >> /etc/httpd/conf.d/django.conf
#IN HTTPD FILE??? LoadModule wsgi_module modules/mod_wsgi.so

cd ..
cd conf
echo 'LoadModule wsgi_module modules/mod_wsgi.so' >> httpd.conf


#Permission Issues
cd
sudo usermod -a -G localuser apache
chmod 710 /home/localuser
chmod 664 ~/Desktop/ScenarioOne8/toDoList/db.sqlite3
sudo chown :apache ~/Desktop/ScenarioOne8/toDoList/db.sqlite3
sudo chown :apache ~/Desktop/ScenarioOne8/toDoList

#Start server
sudo systemctl start httpd
